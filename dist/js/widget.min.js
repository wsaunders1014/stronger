function getCookie(e){for(var t=e+"=",s=decodeURIComponent(document.cookie).split(";"),i=0;i<s.length;i++){for(var a=s[i];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function setCookie(e,t){var s=new Date;s.setTime(s.getTime()+36e5);var i="expires="+s.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var fileReady=!1,twtShared=!1,fbShared=!1,session_token=session.sessionID;setCookie("session_token",session_token),$(document).ready(function(){function e(){fileReady=!1,$("#save-btn").hide().removeClass("disabled"),$("#create").find("label").show(),$("#share").hide(),$("#video").val(""),$("#create-btn").removeClass("disabled"),$("progress").hide(),$("#spinner").hide(),$("#create").show()}$.ajaxSetup({cache:!0}),$(".contest-iframe").css({height:"auto !important"}),$.get("https://strengthdefinesus.com/sessions/"+session_token).done(function(t){if(console.log(JSON.parse(t)),null!=t&&(t=JSON.parse(t),session=t),session.url&&session.type){if($("#create").hide(),"true"==session.mobile&&"video"==session.type&&$("#instagram-btn").hide(),$("#share").show(),"video"==session.type){var s=document.createElement("VIDEO");s.setAttribute("controls","controls"),s.setAttribute("autoplay","autoplay"),s.setAttribute("muted","muted"),s.setAttribute("loop","loop"),s.setAttribute("playsinline","true"),s.setAttribute("src",session.aws),$("#preview").html("").append(s),s.addEventListener("canplay",function(){$("#preview").find("video").height()<=.5625*$("#preview").find("video").width()?$("#preview").find("video").addClass("landscape"):$("#preview").find("video").addClass("portrait")}),s.load(),s.play()}else{var i=new Image;i.onload=function(){i.height<=.5625*i.width?i.setAttribute("class","landscape"):i.setAttribute("class","portrait")},i.onerror=function(){e();var t=document.createElement("VIDEO");t.setAttribute("controls","controls"),t.setAttribute("autoplay","autoplay"),t.setAttribute("muted","muted"),t.setAttribute("loop","loop"),t.setAttribute("playsinline","true"),t.setAttribute("class","landscape"),t.setAttribute("src","https://strengthdefinesus.com/media/preview.mp4"),$("#preview").html("").append(t),t.load(),t.play()},i.src=session.url,$("#preview").html("").append(i)}$("#instagram-btn").find("a").attr("href",session.aws),$("#facebook-btn").attr("data-url",session.aws),$("#twitter-btn").attr("data-url",session.url)}});var t="steel",s="true"==session.mobile?"touchstart":"click";$(".square").on("click touchstart tap",function(e){e.preventDefault(),e.stopPropagation();var s=$(this).attr("id");switch($(".square").removeClass("active"),$(this).addClass("active"),t=s,s){case"steel":$("#preview-overlay").find(".upper").attr("src","https://strengthdefinesus.com/img/overlay_text.png?"+Date.now());break;case"black":$("#preview-overlay").find(".upper").attr("src","https://strengthdefinesus.com/img/overlay_textb.png?"+Date.now());break;case"white":$("#preview-overlay").find(".upper").attr("src","https://strengthdefinesus.com/img/overlay_textw.png?"+Date.now())}}),$("#save-btn").on("click",function(s){s.preventDefault(),$("progress").show(),$("#save-btn").addClass("disabled"),$(".options").css({visibility:"hidden"});var i=new FormData($("#video-upload")[0]);i.append("color",t),i.append("session_token",session_token),$.ajax({url:"https://strengthdefinesus.com/upload",type:"POST",contentType:!1,data:i,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){e.lengthComputable&&($("progress").attr({value:e.loaded,max:e.total}),e.loaded>=e.total&&($("progress").hide(),$("#spinner").show(),$(".error").html("Filed uploaded. Now encoding...")))},!1),e}}).done(function(t){if(fileReady=!1,console.log(t),t.error)$("#spinner").hide(),$(".error").html(t.message),e();else{if($("#spinner").hide(),$("progress").hide(),$("#preview-overlay").hide(),"video"==t.type){var s=document.createElement("VIDEO");s.setAttribute("controls","controls"),s.setAttribute("autoplay","autoplay"),s.setAttribute("muted","muted"),s.setAttribute("loop","loop"),s.setAttribute("playsinline","true"),s.setAttribute("src",t.aws_url),$("#preview").html("").append(s),s.addEventListener("canplay",function(){$("#preview").find("video").height()<=.5625*$("#preview").find("video").width()?($("#preview").find("video").addClass("landscape"),$("#preview-overlay").css({width:"100%"})):($("#preview").find("video").addClass("portrait"),$("#preview-overlay").css({width:$("#preview").find("video").width()})),$(".options").css({left:($("#preview").width()-$("#preview").find("video").width())/2})}),s.load(),s.play(),"true"==session.mobile&&$("#instagram-btn").hide()}else{var i=new Image;i.onload=function(){i.height<=.5625*i.width?i.setAttribute("class","landscape"):i.setAttribute("class","portrait")},i.src=t.server_url,$("#preview").html("").append(i)}$("#create").hide(),$("#share").show(),$("#instagram-btn").find("a").attr("href",t.aws_url),$("#facebook-btn").attr("data-url",t.aws_url),session.type=t.type,$("#twitter-btn").attr("data-url",t.server_url),console.log("Time Elapsed: "+t.timeElapsed+" seconds")}})}),$("#video").on("change",function(t){if(t.preventDefault(),!fileReady){$(".error").html("");var s=this.files[0];if($("#preview").width(),this.files[0].size/1e3/1024>150)return $(".error").html("File size must be under 150mb."),e(),!1;if(!s.type.match("image/*")&&!s.type.match("video/*"))return $(".error").html("Invalid file type."),e(),!1;var i=URL.createObjectURL(s);if($(".options").css({visibility:"visible"}),s.type.match("video/*")){var a=document.createElement("VIDEO");a.setAttribute("controls","controls"),a.setAttribute("autoplay","autoplay"),a.setAttribute("muted","muted"),a.setAttribute("loop","loop"),a.setAttribute("playsinline","true"),a.setAttribute("src",i),$("#preview").html("").append(a),a.addEventListener("canplay",function(){console.log(a.videoWidth),a.videoWidth<300||a.videoHeight<300?($(".error").html("Video size must be at least 300 x 300 pixels."),e()):(a.videoHeight<=.5625*a.videoWidth?($("#preview").find("video").addClass("landscape"),$("#preview-overlay").css({width:"100%"})):($("#preview").find("video").addClass("portrait"),$("#preview-overlay").css({width:$("#preview").find("video").width()})),$(".options").css({left:($("#preview").width()-$("#preview").find("video").width())/2}))}),a.load(),a.play()}else{var o=new Image;o.onload=function(){o.width<300||o.height<300?$(".error").html("Image size must be at least 300 x 300 pixels."):(o.height<.5625*o.width?(o.setAttribute("class","landscape"),$("#preview-overlay").css({height:o.height})):(o.setAttribute("class","portrait"),$("#preview-overlay").css({height:o.height}),$("#preview-overlay").css({width:o.width})),$(".options").css({left:($("#preview").width()-o.width)/2}))},o.src=i,$("#preview").html("").append(o)}$("#preview-overlay").show(),fileReady=!0,$("#create").find("label").hide(),$("#save-btn").css({display:"inline-block"})}}),$("#restart-btn").on("click touchstart tap",function(t){t.preventDefault(),t.stopPropagation(),$(".error").html(""),e()}),$("#facebook-btn").on("click",function(e){e.preventDefault(),e.stopPropagation();window.open("https://strengthdefinesus.com/shareWindow?mode=facebook&aws="+$("#facebook-btn").attr("data-url")+"&url="+$("#facebook-btn").attr("data-url")+"&type="+session.type,"shareWindow","location=0,status=0,width=800,height=600")}),$("#twitter-btn").on("click",function(e){e.preventDefault(),e.stopPropagation();window.open("https://strengthdefinesus.com/twtAuth?url="+$("#twitter-btn").attr("data-url")+"&type="+session.type,"shareWindow","location=0,status=0,width=800,height=400")}),$("#share-btn").on(s,function(e){e.preventDefault(),$(".share-spinner").show(),$("#share-btn").addClass("disabled"),$(this).hasClass("twitter")?twtShared||(twtShared=!0,$.ajax({url:"https://strengthdefinesus.com/postToTwitter",type:"POST",data:{status:$("#share-modal").find("textarea").val(),url:session.url,type:session.type}}).done(function(e){console.log(e),"success"==e.status?($("#share-modal").find(".pre").hide().next().show(),$("#twitter-btn").addClass("disabled"),setTimeout(function(){$("#share-modal").hide(),$("#share-btn").removeClass("disabled"),$("#share-modal").find(".pre").show().next().hide()},2e3)):(twtShared=!1,$("#share-modal").find(".pre").hide().next().html("<h2>There was an error:</h2><p>"+e.errors+"</p>").show())})):$(this).hasClass("facebook")&&(fbShared||(fbShared=!0,"video"==session.type||-1!=session.url.indexOf(".gif")?FB.api("/me/videos","post",{file_url:session.aws,description:$("#share-modal").find("textarea").val(),title:"Strength Defines Us #strongermovie"},function(e,t){console.log(e,t),$(".share-spinner").hide(),t?(console.log(t),fbShared=!1,$("#share-btn").removeClass("disabled"),$("#share-modal").find(".pre").hide().next().html("<h3>There was an error:</h3><p>"+data.err.code+"</p>").show()):(fbShared=!0,$("#share-modal").find(".pre").hide().next().html("<h3>Posted to Facebook.</h3><p>For videos, please allow up to a few minutes for it to show.</p>").show(),setTimeout(function(){$("#share-modal").hide(),$("#share-modal").find(".pre").show().next().hide(),$("#facebook-btn").addClass("disabled"),$("#share-btn").removeClass("disabled")},2500))}):"image"==session.type&&-1==session.url.indexOf(".gif")&&FB.api("/me/photos","post",{caption:$("#share-modal").find("textarea").val(),url:session.aws},function(e,t){$(".share-spinner").hide(),console.log(e,t),t?(console.log(t),fbShared=!1,$("#share-btn").removeClass("disabled"),$("#share-modal").find(".pre").hide().next().html("<h3>There was an error:</h3><p>"+t.message+"</p>").show()):(fbShared=!0,$("#share-modal").find(".pre").hide().next().html("<h3>Posted to Facebook.</h3><p>For videos, please allow up to a few minutes for it to show.</p>").show(),setTimeout(function(){$("#share-modal").hide(),$("#facebook-btn").addClass("disabled"),$("#share-btn").removeClass("disabled")},2500))})))}),$(".close-btn").on("click touchstart tap",function(e){e.preventDefault(),e.stopPropagation(),$("#share-modal").hide()})});